generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CUSTOMER
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum OrderStatus {
  PENDING
  PROCESSING
  COMPLETED
  CANCELLED
}

enum IntegrationType {
  SHIPPING
  PAYMENTS
  ERP
  CRM
  OTHER
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(CUSTOMER)
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

model Category {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  heroImage   String?
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Product {
  id                String         @id @default(cuid())
  name              String
  slug              String         @unique
  sku               String?
  description       String?
  shortDescription  String?
  highlights        String[]       @default([])
  image             String?
  gallery           String[]       @default([])
  price             Decimal        @db.Numeric(10, 2)
  compareAtPrice    Decimal?       @db.Numeric(10, 2)
  stock             Int            @default(0)
  isFeatured        Boolean        @default(false)
  status            ProductStatus  @default(DRAFT)
  categoryId        String?
  category          Category?      @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  prices            ProductPrice[]
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  orderItems        OrderItem[]
}

model PriceList {
  id          String         @id @default(cuid())
  name        String
  description String?
  currency    String         @default("BRL")
  isDefault   Boolean        @default(false)
  active      Boolean        @default(true)
  products    ProductPrice[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

model ProductPrice {
  id           String      @id @default(cuid())
  productId    String
  priceListId  String
  amount       Decimal     @db.Numeric(10, 2)
  product      Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
  priceList    PriceList   @relation(fields: [priceListId], references: [id], onDelete: Cascade)

  @@unique([productId, priceListId])
}

model SiteSetting {
  id             Int           @id @default(1)
  heroTitle      String
  heroSubtitle   String
  heroHighlight  String?
  heroImage      String?
  aboutHeading   String?
  aboutBody      String?
  mission        String?
  whatsapp       String?
  bannerCta      String?
  contactEmail   String
  contactPhone   String
  addressLine    String
  city           String
  state          String
  postalCode     String
  storeHours     String?
  shippingInfo   String?
  returnPolicy   String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  banners        Banner[]
  integrations   Integration[]
}

model Banner {
  id            String      @id @default(cuid())
  title         String
  description   String?
  image         String?
  buttonLabel   String?
  buttonLink    String?
  siteSettingId Int
  siteSetting   SiteSetting @relation(fields: [siteSettingId], references: [id], onDelete: Cascade)
}

model Integration {
  id            String           @id @default(cuid())
  name          String
  provider      String
  type          IntegrationType
  apiKey        String?
  baseUrl       String?
  active        Boolean          @default(true)
  metadata      Json?
  siteSettingId Int?
  siteSetting   SiteSetting?     @relation(fields: [siteSettingId], references: [id], onDelete: SetNull)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
}

model Order {
  id              String       @id @default(cuid())
  userId          String?
  user            User?        @relation(fields: [userId], references: [id], onDelete: SetNull)
  customerName    String
  customerEmail   String
  customerPhone   String?
  notes           String?
  total           Decimal      @db.Numeric(10, 2)
  status          OrderStatus  @default(PENDING)
  shippingAddress Json?
  items           OrderItem[]
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model OrderItem {
  id         String   @id @default(cuid())
  orderId    String
  productId  String?
  product    Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  productName String
  quantity   Int
  unitPrice  Decimal  @db.Numeric(10, 2)
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}
